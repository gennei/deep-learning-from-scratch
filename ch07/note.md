# 7 畳み込みニューラルネットワーク

## 7.1 全体の構造

- 畳み込み層とプーリング層が追加

## 7.2 畳み込み層
- パディング
- ストライド

### 7.2.1 全結合の問題点
- データの形状が無視される
- 画像データの縦、横、チャンネル方向の3次元データ
- 全結合では1次元のデータとして扱っていた

- CNN では畳み込み層は形状を維持する
- 畳み込み層の入出力データを**特徴マップ**という
- 入力データは**入力特徴マップ**という
- 出力データを**出力特徴マップ**という

### 7.2.2 畳み込み演算
- 入力データ * フィルター + バイアス → 出力データ
- フィルター = 重み

### 7.2.3 パディング
- 出力データのサイズの調整を行うためにやる

### 7.2.4 ストライド
- ストライドはフィルタを適用する間隔
- 入力サイズ（H, W）
- フィルターサイズ(FH, FW)
- 出力サイズ(OH, OW)
- パディング(P)
- ストライド(S)

とすると、

```
OH = ((H + 2P - FH) / S) + 1
OW = ((W + 2P - FW) / S) + 1
```

### 7.2.5 3次元データの畳み込み演算
- 入力データとフィルターのチャンネル数は同じ値にする
- フィルタのサイズは自由

### 7.2.6 ブロックで考える
### 7.2.7 バッチ処理

## 7.3 プーリング層
- プーリングは縦横方向の空間を小さくする演算

### 7.3.1 プーリング層の特徴
- 学習するパラメータが少ない
- チャンネル数は変化しない
- 微小な位置変化に対してロバスト

## 7.4 Convolution / Pooling レイヤの実装

### 7.4.1 4次元配列
- CNNでは各層を流れるデータは4次元
- データの形状(10, 1, 28, 28)は高さ28、幅28、1チャンネル、データが10個

```python
x = np.random.rand(10, 1, 28, 28)
```

### 7.4.2 im2col による展開
- 愚直に実装するとforの多重ループになりがち
- im2colで解決する
- image 2 column
- 画像データを行列へ変換するようなイメージ
- 行列計算を高速化するアルゴリズムはたくさんあるので高速に計算しやすい
- ただし、メモリを大量に消費する

### 7.4.3 Convolution レイヤの実装
